-- SQL migrations: idempotent & reversible
BEGIN;
-- forward
ALTER TABLE GOLD.ORDERS ADD COLUMN CHANNEL STRING;
-- backfill (off-peak)
UPDATE GOLD.ORDERS SET CHANNEL='web' WHERE CHANNEL IS NULL;
-- verify
SELECT COUNT(*) FROM GOLD.ORDERS WHERE CHANNEL IS NULL;
-- rollback sample
ALTER TABLE GOLD.ORDERS DROP COLUMN CHANNEL;
COMMIT;
